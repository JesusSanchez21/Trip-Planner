<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Best Restaurants</title>
    <link rel="stylesheet" href="css/api.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

</head>
<body>
    <iframe id="headerFrame" src="header.html" style="width: 100%; border: none;"></iframe>

    <form id="attractionForm">
        <label for="location">Enter Location:</label>
        <input type="text" id="location" name="location" required>
        <button type="submit">Search</button>
    </form>

    <div id="result" class="result-container"></div>

    <button id="loadMoreBtn">Load More</button>

    <script>
        let currentPage = 1;

        document.getElementById('attractionForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            currentPage = 1; // Reset page number on new search
            const location = document.getElementById('location').value;
            await fetchData(location);
        });

        document.getElementById('loadMoreBtn').addEventListener('click', async function() {
            currentPage++; // Increment page number
            const location = document.getElementById('location').value;
            await fetchData(location);
        });

        async function fetchData(location) {
            const firstApiUrl = `https://tripadvisor16.p.rapidapi.com/api/v1/restaurant/searchLocation?query=${location}`;
            const firstApiOptions = {
                method: 'GET',
                headers: {
                    'X-RapidAPI-Key': 'dd5a75eb60msh51f65e7da97887ap170803jsn4ce1df7989bc',
                    'X-RapidAPI-Host': 'tripadvisor16.p.rapidapi.com'
                },
            };

            try {
                const response = await fetch(firstApiUrl, firstApiOptions);
                const result = await response.json();
                const locationId = result.data[0].locationId; // Extract location ID from the response
                await fetchSecondApi(locationId);
            } catch (error) {
                console.error(error);
            }
        }

        async function fetchSecondApi(locationId) {
            const secondApiUrl = `https://tripadvisor16.p.rapidapi.com/api/v1/restaurant/searchRestaurants?locationId=${locationId}`;
            const secondApiOptions = {
                method: 'GET',
                headers: {
                    'X-RapidAPI-Key': 'dd5a75eb60msh51f65e7da97887ap170803jsn4ce1df7989bc',
                    'X-RapidAPI-Host': 'tripadvisor16.p.rapidapi.com'
                }
            };

            try {
                const response = await fetch(secondApiUrl, secondApiOptions);
                const result = await response.json();
                displayRestaurants(result); // Pass the restaurant data to a display function
            } catch (error) {
                console.error(error);
            }
        }

        function displayRestaurants(result) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = ''; // Clear previous result

            if (result.status && result.data && result.data.totalRecords > 0) {
                result.data.data.forEach(restaurant => {
                    const restaurantDiv = document.createElement('div');
                    restaurantDiv.classList.add('restaurant-card'); // Add class to restaurant card
                    restaurantDiv.innerHTML = `
                        <h3>${restaurant.name}</h3>
                        <p>Average Rating: ${restaurant.averageRating}</p>
                        <p>User Review Count: ${restaurant.userReviewCount}</p>
                        <p>Open Status: ${restaurant.currentOpenStatusText}</p>
                        <p>Price Tag: ${restaurant.priceTag}</p>
                        ${restaurant.menuUrl ? `<p><a href="${restaurant.menuUrl}" target="_blank">Menu</a></p>` : ''}
                        <img src="${restaurant.squareImgUrl}" alt="${restaurant.name} Image">
                        <p><strong>Review Snippets:</strong></p>
                        <ul>
                            ${restaurant.reviewSnippets.reviewSnippetsList.map(snippet => `<li><a href="${snippet.reviewUrl}" target="_blank">${snippet.reviewText}</a></li>`).join('')}
                        </ul>
                    `;
                    resultDiv.appendChild(restaurantDiv);
                });
            } else {
                const message = document.createElement('p');
                message.textContent = 'No restaurants found.';
                resultDiv.appendChild(message);
            }
        }

        //header maybe
        // Function to load content into the iframe
    function loadContent(page) {
        document.getElementById('content').innerHTML = '';
        document.getElementById('content').innerHTML = `<iframe src="${page}" style="width: 100%; border: none;"></iframe>`;
    }

    // Load initial content
    loadContent('HomePage.html'); // Change 'HomePage.html' to your initial page

    // Function to handle navigation
    function navigateTo(page) {
        loadContent(page);
    }
    </script>
</body>
</html>
